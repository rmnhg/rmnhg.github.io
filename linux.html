<!DOCTYPE HTML>
<!--By Ramón Hernández García @ Copyright 2017-->
<html>

<HEAD>
	<!--Website title-->
	<title>Ramón Hdez - Cómo compilar un kernel de Linux</title>

	<!--Webpage icon - Spain flag-->
	<link rel="icon" type="image/x-icon" href="assets/img/favicon.ico">

	<!--Meta_tags-->
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="Ramón HDEZ - Creador" content="Copyright 2017 (c) Ramón Hernández García.">
	<meta name="robots" content="NOODP">
	<meta name="description" content="Página personal de Ramón Hernández, estudiante madrileño.">
	<meta name="author" content="Ramón Hernández">
	<meta name="keywords" content="Linux; Android; Ramón Hernández; web; Material Design">

	<!--Theme starts here-->	
		<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />

		<!--	 Fonts and icons	 -->
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
		<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" />
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />

		<!-- CSS Files -->
		<link href="assets/css/bootstrap.min.css" rel="stylesheet" />
		<link href="assets/css/material-kit.css" rel="stylesheet"/>

		<!-- CSS Just for demo purpose, don't include it in your project -->
		<link href="assets/css/demo.css" rel="stylesheet" />

	<!--Theme ends here-->
</HEAD>

<BODY class="index-page">

	<!-- Navbar -->
	<nav class="navbar navbar-transparent navbar-fixed-top navbar-color-on-scroll">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-index">
					<span class="sr-only">Abrir/cerrar navbar</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a href="https://www.github.com/rmnhg">
					<div class="logo-container">
						<div class="logo">
							<img src="assets/img/logo.png" alt="Ramón's Logo" rel="tooltip" title="Esta página WEB ha sido creada por Ramón Hernández" data-placement="bottom" data-html="true">
						</div>
						<div class="brand">
						Ramón Hernández
						</div>
					</div>
				</a>
			</div>

			<div class="collapse navbar-collapse" id="navigation-index">
				<ul class="nav navbar-nav navbar-right">
					<li>
						<a href="https://rmnhg.github.io">Página principal
						</a>
					</li>
					<li>
						<a href="/theory">Teoría
						</a>
					</li>
					<li>
						<a href="/testing">Laboratorio
						</a>
					</li>
					<li>
						<a rel="tooltip" title="Sígueme en Twitter" data-placement="bottom" href="https://twitter.com/ramonhg00" target="_blank" class="btn btn-white btn-simple btn-just-icon">
							<i class="fa fa-twitter"></i>
						</a>
					</li>
					<li>
						<a rel="tooltip" title="Sígueme en Github" data-placement="bottom" href="https://github.com/rmnhg" target="_blank" class="btn btn-white btn-simple btn-just-icon">
							<i class="fa fa-github"></i>
						</a>
					</li>

				</ul>
			</div>
		</div>
	</nav>
	<!-- End Navbar -->
	<!--Floating settings button -->
	<div class="fixed-plugin">
            <div class="dropdown">
                <a href="#" data-toggle="dropdown" aria-expanded="false">
                <i class="fa fa-cog fa-2x"> </i>
                </a>
                <ul class="dropdown-menu">
                    <li class="header-title">Ajustes</li>
                </ul>
            </div>
        </div>
	<!--Floating settings button end-->
	<!--Background image-->
	<div class="wrapper">
	<div class="header" style="background-image: url('assets/img/bg3.jpeg');">
		<div class="container">
			<div class="col-md-8 col-md-offset-2">
				<div class="brand">
					<h1>Cómo compilar un kernel Linux</h1>
					<!--These entries are only for making parallax effect work-->
					<div id="sliderRegular" class="slider" style="visibility: hidden;"></div>
					<div id="sliderDouble" class="slider slider-info" style="visibility: hidden;"></div>
					<!--Finish here-->
				</div>
			</div>
		</div>
	</div>

	<div class="main main-raised"> <!--Floating cloud-->
	<div class="container"> <!--Make it more centered-->

	<div style="margin: 30px;">
	<h1><b>Cómo compilar un kernel Linux</b></h1> <!--Strong works as bold-->
	<br>

	<h4 style="font-size: xx-large;"><b>Índice</span></b></h4>
	<!--This makes a list-->
	<ul>
	<li><a href="#linux">Información básica. ¿Qué es Linux? ¿Qué es un kernel?</a></li>
	</ul>
	<br>

	<center>
	<h2 id="linux"><b>¿Qué es Linux?</b></h2>
	</center>
	Linux en un sistema operativo de código libre utilizado actualmente por millones de dispositivos en todo el planeta. Muchos sistemas operativos y sistemas están basados en los pilares de Linux, algunas de las distribuciones Linux más conocidas son Ubuntu, Debian u OpenSuse. El núcleo de Linux se llama <b>kernel</b> y está programado principalmente en C. Este núcleo es el que hace que todo funcione como funciona y es la base de cualquier sistema operativo basado en Linux.<br>
	<br>
	Pero Linux no solo se limita a equipos fijos, también abarca los dispositivos móviles. Un ejemplo muy conocido actualmente es Android. Android es uno de los sistemas operativos más utlizados en los dispositivos portátiles y su proyecto AOSP (Android Open Source Project) consiste en compartir libremente el código de su sistema operativo para que cada fabricante lo adapte a sus productos.
Como Android se basa en Linux también utiliza su kernel con pequeñas modificaciones que lo hacen ejecutarse en procesadores menos potentes.<br>
	Puedes encontrar este kernel en las particiones de boot y aboot de los dispositivos (en el caso de procesadores Snapdragon).<br>
	<b>Aboot</b> es la partición básica que ejecuta el código del bootloader que carga las funciones más básicas, dando paso después al boot.<br>
	<b>Boot</b> es la partición que contiene el kernel de linux en formato zImage, así como las instrucciones de inicio de Android y el Device Tree, que es la información acerca de los sensores del dispositivo: la corriente que necesitan y cómo funcionan.<br>
	En esta página os voy a enseñar cómo compilar el kernel para la partición boot, ya que para compilar el bootloader tenemos otro proyecto más pequeño llamado Little Kernel.<br>
	En la raíz del kernel tenemos muchas carpetas. Las que más utilizaremos serán las carpetas drivers y arch.<br>
	En la carpeta de <b>drivers</b> podemos encontrar todo tipo de controladores de los cuales usaremos tan solo unos pocos. Ahí podremos añadir soporte a más dispositivos y mejorar o arreglar los que ya están creados.<br>
	En la carpeta <b>arch</b> podemos gestionar la configuración del kernel antes de compilar (que nos permite activar y desactivar controladores o funciones), la configuración del procesador de destino y la información de todos los periféricos de entrada y salida que tendrá la plataforma de destino; esto es el Device Tree.<br>
	<br>
	Teniendo un archivo de configuración en arch/&lt;arquitectura_del_procesador_destino&gt;/configs llamado, por ejemplo, Android_defconfig podemos empezar a compilar.<br>
	Para ello vamos a ejecutar este comando que copia ese archivo de configuración a la carpeta principal del kernel asignándole el nombre de ".config":<br>
	<pre><code>make ARCH=<b>&lt;arquitectura_del_procesador_destino&gt;</b> Android_defconfig</code></pre>
	Este es el archivo que el comando "make" leerá al empezar a compilar.<br>
	<br>
	Finalmente para compilar necesitaremos definir un <b>CROSS COMPILE</b>, que es un conjunto de archivos binarios que permiten al procesador de un PC compilar cualquier kernel para un procesador con otra arquitectura diferente (como arm o aarch64).<br>
	En nuestro cross compile tenemos que meternos en la carpeta bin y copiar la ruta de los archivos con su prefijo. Por ejemplo si tengo:<br>
	/media/ramon/Android/prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.9/bin/arm-linux-androidkernel-ar<br>
	Deberé poner "CROSS_COMPILE=/media/ramon/Android/prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.9/bin/arm-linux-androidkernel-". El comando quedaría así:
	<pre><code>make ARCH=<b>&lt;arquitectura_del_procesador_destino&gt;</b> CROSS_COMPILE=/media/ramon/Android/prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.9/bin/arm-linux-androidkernel-</b></code></pre>
	Y al ejecutarlo comenzaría el proceso de compilación del kernel.<br>
	<small><b>Nota:</b> para acelerar el proceso se puede añadir el parámetro <b>-j&lt;número_de_núcleos_del_procesador+1&gt;</b> que utilizará el máximo potencial del procesador.</small><br>
	<br>
	Al final del proceso tendrás un archivo llamado zImage en arch/&lt;arquitectura_del_procesador_destino&gt;/boot que será el kernel en formato binario. Ese fichero se debe incluir en un boot.img y habrá que instalar ese boot.img para probar el nuevo kernel.

	<div style="margin-top: 50px;">
	<p><b>Links útiles:</b></p>
	<ul><!--This makes a list-->
	<li><a href="https://html-online.com/editor/" target="_blank" rel="noopener">Para probar código html</a></li>
	<li><a href="http://www.makeuseof.com/tag/7-cool-html-effects-that-anyone-can-add-to-their-website-nb/" target="_blank" rel="noopener">Para poner efectos guays</a></li>
	<li><a href="https://html-color-codes.info/codigos-de-colores-hexadecimales/" target="_blank" rel="noopener">Selector colores</a></li>
	<li><a href="https://rmnhg.github.io/theory">Teoría</a></li>
	<li><a href="https://rmnhg.github.io/testing">Laboratorio</a></li>
	<li><a href="https://rmnhg.github.io/">Página principal</a></li>
	</ul>
	</div>
	</div>
	</div>
	</div>
</BODY>

	<!--	 Core JS Files for Navigation Bar    -->
	<script src="assets/js/jquery.min.js" type="text/javascript"></script>
	<script src="assets/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="assets/js/material.min.js"></script>

	<!--	Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
	<script src="assets/js/nouislider.min.js" type="text/javascript"></script>

	<!--	Plugin for the Datepicker, full documentation here: http://www.eyecon.ro/bootstrap-datepicker/ -->
	<script src="assets/js/bootstrap-datepicker.js" type="text/javascript"></script>

	<!-- Control Center for Material Kit: activating the ripples, parallax effects, scripts from the example pages etc -->
	<script src="assets/js/material-kit.js" type="text/javascript"></script>

	<script type="text/javascript">

		$().ready(function(){
			// the body of this function is in assets/material-kit.js
			materialKit.initSliders();
            window_width = $(window).width();

            if (window_width >= 992){
                big_image = $('.wrapper > .header');

				$(window).on('scroll', materialKitDemo.checkScrollForParallax);
			}

		});
	</script>
	
</html>
